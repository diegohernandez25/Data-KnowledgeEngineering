{% extends "base.html" %}

{% block content %}

<div class="container-fluid" style="padding-left: 225px">

    <div class="row">
      <div id="map" class="col-sm-9"></div>
      <div class="col-sm-3" style="padding-top: 2%">
         {% block contentbar %}
         {% endblock %}
      </div>
    </div>
    <script src="https://api-maps.yandex.ru/2.1/?lang=en_RU&amp;apikey=<your API-key>" type="text/javascript"></script>
    <script src="icon_customImage.js" type="text/javascript"></script>
	<style>
        #map {
            width: 100%; height: 100vh;
        }
    </style>



   <script>
       ymaps.ready(init);
       ymaps.ready(place);
       var map;
       var lst = [];

       function init() {
           map = new ymaps.Map("map", {
               center: [50, 20],
               zoom: 4
           });
       }

       function recenter() {
           map.setCenter([50, 20]);
           map.setZoom(4);
           //map.geoObjects.removeAll();
       }

       function addPlacemark(lat, long, iata, airport, info) {
           if (!lst.includes(iata)) {
               var placemark = new ymaps.Placemark([lat, long],
                   {
                       hintContent: airport,
                       balloonContent: info
                   }, {
                       /**
                        * Options.
                        * You must specify this type of layout.
                        */
                       iconLayout: 'default#image',
                       // Custom image for the placemark icon.
                       iconImageHref: '/static/assets/aeroplane.png',
                       // The size of the placemark.
                       iconImageSize: [46, 56],
                       /**
                        * The offset of the upper left corner of the icon relative
                        * to its "tail" (the anchor point).
                        */
                       iconImageOffset: [-23, -56]
                   });
               map.geoObjects.add(placemark);
               lst.push(iata)
           }
       }

       function drawRoutes(route, srcName, dstName, srcLat, srcLong, dstLat, dstLong) {
           var recLevel = Math.floor(Math.log2(distance(srcLat, srcLong, dstLat, dstLong)));
           console.log(recLevel);
           rec(route, srcName, dstName, srcLat, srcLong, dstLat, dstLong, recLevel);


       }

       function rec(route, srcName, dstName, srcLat, srcLong, dstLat, dstLong, level) {
           var midpoint = calcMidPoint(srcLat, srcLong, dstLat, dstLong);
           if (level == 0)
                placeMidPoint(route, srcName, dstName, midpoint)
           else {
                rec(route, srcName, dstName, srcLat, srcLong, midpoint[0], midpoint[1], level - 1);
                rec(route, srcName, dstName, midpoint[0], midpoint[1], dstLat, dstLong, level - 1);
           }
       }

       function placeMidPoint(route, srcName, dstName,point) {
           var placemark = new ymaps.Placemark(point,
               {
                   hintContent: "Route " + route,
                   balloonContent: "Route between " + srcName + " and " + dstName
               },
               {
                   iconLayout: 'default#image',
                   iconImageHref: '/static/assets/red_dot.png',
                   iconImageSize: [4, 4],
                   iconImageOffset: [-2, -2]
                   });
               map.geoObjects.add(placemark);
       }

       function distance(srcLat, srcLong, dstLat, dstLong) {
           var lat = srcLat - dstLat;
           var long = srcLong - dstLong;
           return Math.sqrt(lat*lat+long*long);
       }

       function calcMidPoint(srcLat, srcLong, dstLat, dstLong) {
           var lat = (srcLat + dstLat) / 2;
           var long = (srcLong + dstLong) / 2;
           return [lat, long];
       }

</script>
</div>
{% endblock %}
